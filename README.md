# MiniRAG-Local

**MiniRAG-Local** æ˜¯ä¸€å¥—åŸºäº AI Agent çš„æœ¬åœ°çŸ¥è¯†åº“é—®ç­”ç³»ç»Ÿã€‚ä¸ä¼ ç»Ÿ RAG æ–¹æ¡ˆä¸åŒï¼Œå®ƒä¸ä¾èµ–å‘é‡æ•°æ®åº“æˆ– Embedding æ¨¡å‹ï¼Œè€Œæ˜¯ç›´æ¥é©±åŠ¨æœ¬åœ° AI Agentï¼ˆClaude / Gemini CLIï¼‰å¯¹çŸ¥è¯†åº“è¿›è¡Œå®æ—¶æ£€ç´¢ä¸æ¨ç†ã€‚

---

## æˆ‘ä»¬èƒ½åšä»€ä¹ˆ

> ä»¥ NSAG å›¢é˜Ÿå†…éƒ¨éƒ¨ç½²ä¸ºä¾‹

åœ¨é’‰é’‰ç¾¤é‡Œ @ æœºå™¨äººï¼Œå³å¯ç›´æ¥æŸ¥è¯¢ **NSAG äº§å“çŸ¥è¯†åº“** å’Œ **æºç åº“**ï¼š

- æŸ¥è¯¢äº§å“è§„æ ¼ã€æ¥å£å®šä¹‰ã€è®¾è®¡æ–‡æ¡£
- å®šä½æŸä¸ªåŠŸèƒ½åœ¨æºç ä¸­çš„å…·ä½“å®ç°ä½ç½®
- åˆ†æä»£ç é€»è¾‘ã€è§£é‡Šé…ç½®é¡¹å«ä¹‰
- è·¨æ–‡ä»¶ã€è·¨ç›®å½•çš„å…³è”æ¨ç†ï¼ˆ"è¿™ä¸ªé”™è¯¯ç æ˜¯åœ¨å“ªå®šä¹‰çš„ï¼Ÿè°ƒç”¨é“¾æ˜¯ä»€ä¹ˆï¼Ÿ"ï¼‰
- ç›´æ¥åœ¨å¯¹è¯ä¸­ç”Ÿæˆä»£ç ç‰‡æ®µã€å†™æ³¨é‡Šã€åš Code Review

```
é’‰é’‰ç¾¤ç”¨æˆ·
    â”‚  @ æœºå™¨äººæé—®
    â–¼
é’‰é’‰æœºå™¨äººï¼ˆStream æ¨¡å¼ï¼Œæ— éœ€å…¬ç½‘ IPï¼‰
    â”‚
    â–¼
MiniRAG é’‰é’‰æ¨¡å—ï¼ˆdingtalk/bot.jsï¼‰
    â”‚  HTTP â†’ OpenAI å…¼å®¹æ¥å£
    â–¼
OpenAI Proxyï¼ˆproxy/openai_proxy.jsï¼‰
    â”‚  HTTP â†’ AgentAPI
    â–¼
AgentAPIï¼ˆGoï¼ŒPTY ç»ˆç«¯æ¨¡æ‹Ÿï¼‰
    â”‚  å¯åŠ¨å¹¶é©±åŠ¨
    â–¼
Claude CLI / Gemini CLI
    â”‚  grep / cat / ls / MCP å·¥å…·
    â–¼
NSAG çŸ¥è¯†åº“ + æºç åº“ï¼ˆæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼‰
```

---

## æ¶æ„å›¾

```mermaid
flowchart TD
    A["ğŸ‘¤ é’‰é’‰ç”¨æˆ·\nï¼ˆç¾¤æ¶ˆæ¯ @ æœºå™¨äººï¼‰"] -->|Stream WebSocket| B["ğŸ¤– é’‰é’‰æœºå™¨äºº\nStream æ¨¡å¼ï¼Œæ— éœ€å…¬ç½‘IP"]
    B -->|HTTP POST\nOpenAI æ ¼å¼| C["ğŸ”€ OpenAI Proxy\nNode.js"]
    C -->|HTTP POST\n/message| D["âš™ï¸ AgentAPI\nGo Â· PTY ç»ˆç«¯æ¨¡æ‹Ÿ"]
    D -->|å¯åŠ¨ / é©±åŠ¨| E["ğŸ§  AI Agent\nClaude CLI / Gemini CLI"]
    E -->|grep / cat / ls\nMCP å·¥å…·| F[("ğŸ“š çŸ¥è¯†åº“ + æºç åº“\næœ¬åœ° Markdown / ä»£ç æ–‡ä»¶")]
    F -->|æ–‡ä»¶å†…å®¹| E
    E -->|å›å¤æ–‡æœ¬| D
    D -->|è½®è¯¢ /messages| C
    C -->|OpenAI å…¼å®¹å“åº”| B
    B -->|å¡ç‰‡æ¶ˆæ¯| A

    style A fill:#0066FF,color:#fff
    style B fill:#0066FF,color:#fff
    style E fill:#6B46C1,color:#fff
    style F fill:#2D6A4F,color:#fff
```

---

## ä¸ä¼ ç»Ÿ RAG æ–¹æ¡ˆçš„å¯¹æ¯”

```mermaid
flowchart LR
    subgraph T["ä¼ ç»Ÿ RAGï¼ˆå‘é‡æ£€ç´¢ï¼‰"]
        direction TB
        T1["ç”¨æˆ·æé—®"] --> T2["Embedding æ¨¡å‹\næ–‡æœ¬å‘é‡åŒ–"]
        T2 --> T3["å‘é‡æ•°æ®åº“\nTop-K ç›¸ä¼¼æ£€ç´¢"]
        T3 --> T4["LLM\nåŸºäºå¬å›ç‰‡æ®µç”Ÿæˆå›ç­”"]
    end

    subgraph M["MiniRAG-Localï¼ˆAgent ç›´é©±ï¼‰"]
        direction TB
        M1["ç”¨æˆ·æé—®"] --> M2["AI Agent\nClaude / Gemini"]
        M2 --> M3["å·¥å…·è°ƒç”¨\ngrep / cat / MCP / ä»£ç æ‰§è¡Œ"]
        M3 --> M4["æ¨ç†ä¸å›ç­”\nå¤šè½®ã€å…³è”ã€å¯æ“ä½œ"]
    end
```

| ç»´åº¦ | ä¼ ç»Ÿ RAG | MiniRAG-Local |
|------|----------|---------------|
| æ£€ç´¢æ–¹å¼ | å‘é‡ç›¸ä¼¼åº¦ Top-K å¬å› | AI Agent ä¸»åŠ¨æ–‡ä»¶æ£€ç´¢ |
| éƒ¨ç½²ä¾èµ– | Embedding æ¨¡å‹ + å‘é‡åº“ | ä»…éœ€ AI CLI + Node.js |
| çŸ¥è¯†æ›´æ–° | éœ€é‡æ–° Embedding ç´¢å¼• | å®æ—¶è¯»å–ï¼Œæ— éœ€é¢„å¤„ç† |
| æ¨ç†èƒ½åŠ› | å—é™äºå¬å›è´¨é‡ | Agent å¤šè½®æ¨ç†ï¼Œè·¨æ–‡ä»¶å…³è” |
| æ‰©å±•å·¥å…· | æœ‰é™ | å…¨éƒ¨ Agent Skills + MCP |
| å¹¶å‘èƒ½åŠ› | é«˜ | **å•å¹¶å‘**ï¼ˆè§å±€é™æ€§ï¼‰|

---

## ä¼˜åŠ¿

### 1. å…¨éƒ¨ Agent èƒ½åŠ›å¼€ç®±å³ç”¨

ä¸æ˜¯ç®€å•çš„"æ£€ç´¢ + ç”Ÿæˆ"ï¼Œè€Œæ˜¯æŠŠ AI Agent å®Œæ•´èƒ½åŠ›æš´éœ²ç»™ç”¨æˆ·ï¼š

- **æ–‡ä»¶ç³»ç»Ÿå·¥å…·**ï¼š`grep`ã€`cat`ã€`find`ã€`ls` â€”â€” ç²¾å‡†å®šä½ä»»æ„æ–‡ä»¶å†…å®¹
- **ä»£ç æ‰§è¡Œ**ï¼šç›´æ¥è¿è¡Œè„šæœ¬ã€éªŒè¯é€»è¾‘
- **MCP å·¥å…·**ï¼šClaude / Gemini æ”¯æŒçš„æ‰€æœ‰ MCP Server å‡å¯ç›´æ¥è°ƒç”¨ï¼ˆæ•°æ®åº“ã€APIã€æµè§ˆå™¨ç­‰ï¼‰
- **å¤šè½®æ¨ç†**ï¼šä¸æ˜¯ä¸€æ¬¡æ£€ç´¢äº†äº‹ï¼ŒAgent ä¼šæ ¹æ®ä¸­é—´ç»“æœç»§ç»­æ·±æŒ–

### 2. æç®€éƒ¨ç½²ï¼Œæ— éœ€é¢„å¤„ç†

æ— éœ€ï¼š
- æ­å»ºå‘é‡æ•°æ®åº“ï¼ˆChroma / Pinecone / Qdrantï¼‰
- è¿è¡Œ Embedding æœåŠ¡ï¼ˆOpenAI API / æœ¬åœ°æ¨¡å‹ï¼‰
- å¯¹çŸ¥è¯†åº“åšç´¢å¼•ï¼ˆæ–‡æ¡£åˆ†å—ã€å‘é‡åŒ–ã€å…¥åº“ï¼‰

çŸ¥è¯†åº“æœ‰å˜æ›´ï¼Ÿç›´æ¥æ›´æ–°æ–‡ä»¶ï¼Œä¸‹æ¬¡æé—®ç«‹å³ç”Ÿæ•ˆã€‚

### 3. å¼ºå¯å®šåˆ¶æ€§

- é€šè¿‡ `STARTUP_PROMPT` ç»™ Agent æ³¨å…¥è§’è‰²å®šä¹‰å’Œè¡Œä¸ºè§„èŒƒ
- é€šè¿‡ `CLAUDE_ARGS` / `GEMINI_ARGS` è‡ªç”±åˆ‡æ¢æ¨¡å‹å‚æ•°
- é’‰é’‰ç¾¤è·¯ç”±ï¼ˆ`DINGTALK_RAG_GROUPS`ï¼‰æ”¯æŒä¸åŒç¾¤å¯¹æ¥ä¸åŒçŸ¥è¯†åº“ç«¯ç‚¹
- å¯¹æ¥ä»»ä½•æ”¯æŒ OpenAI æ¥å£çš„å‰ç«¯ï¼ˆæ²¹çŒ´æ’ä»¶ã€Cursorã€VS Code ç­‰ï¼‰

---

## å±€é™æ€§

### âš ï¸ å•å¹¶å‘

æ•´å¥—ç³»ç»Ÿ**åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚**ã€‚

AgentAPI ç»´æŠ¤ä¸€ä¸ª PTY ä¼šè¯ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ª AI Agent è¿›ç¨‹ã€‚å¤šä¸ªè¯·æ±‚åŒæ—¶è¿›æ¥æ—¶ï¼Œåç»­è¯·æ±‚éœ€è¦æ’é˜Ÿç­‰å¾…ã€‚

**å½±å“åœºæ™¯**ï¼šå¤šäººåŒæ—¶ @ æœºå™¨äººæ—¶ï¼Œåå‘çš„æ¶ˆæ¯éœ€ç­‰å‰ä¸€æ¡å¤„ç†å®Œæ‰ä¼šå“åº”ã€‚  
**é€‚ç”¨åœºæ™¯**ï¼šå›¢é˜Ÿå†…éƒ¨ä½é¢‘çŸ¥è¯†æŸ¥è¯¢ã€ä¸ªäººåŠ©æ‰‹ã€æ¼”ç¤ºç¯å¢ƒã€‚

### âš ï¸ å®‰å…¨é£é™©

é»˜è®¤å¯åŠ¨å‚æ•°ï¼ˆ`--dangerously-skip-permissions` / `--yolo`ï¼‰èµ‹äºˆ AI Agent å¯¹æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å®Œå…¨è®¿é—®æƒé™ï¼ŒåŒ…æ‹¬è¯»å–ã€æ‰§è¡Œå‘½ä»¤ã€å†™å…¥æ–‡ä»¶ã€‚

**è¯·å‹¿åœ¨å…¬ç½‘æˆ–ä¸å—ä¿¡ä»»çš„ç¯å¢ƒä¸­æš´éœ²æœåŠ¡ç«¯å£ã€‚**

è¯¦è§ä¸‹æ–¹[å®‰å…¨é…ç½®](#å®‰å…¨é…ç½®)ã€‚

### âš ï¸ å“åº”å»¶è¿Ÿ

Agent éœ€è¦å®æ—¶æ‰§è¡Œæ–‡ä»¶æ£€ç´¢å·¥å…·è°ƒç”¨ï¼Œå“åº”æ—¶é—´é€šå¸¸åœ¨ **5ï½30 ç§’**ï¼Œè¿œé«˜äºä¼ ç»Ÿ RAG çš„æ¯«ç§’çº§å¬å›ã€‚å¤æ‚é—®é¢˜ï¼ˆå¦‚å¤§å‹ä»£ç åº“æ‰«æï¼‰å¯èƒ½æ›´é•¿ã€‚

---

## å®‰å…¨é…ç½®

> é»˜è®¤é…ç½®é¢å‘æœ¬åœ°å¼€å‘ï¼Œç”Ÿäº§/æ¼”ç¤ºç¯å¢ƒè¯·æŒ‰éœ€è°ƒæ•´ã€‚

**æ–¹å¼ 1ï¼šç§»é™¤å±é™©å‚æ•°**
```bash
# .env
CLAUDE_ARGS=   # å»æ‰ --dangerously-skip-permissions
GEMINI_ARGS=--yolo --include-directories /path/to/safe/folder
```

**æ–¹å¼ 2ï¼šé™åˆ¶çŸ¥è¯†åº“ç›®å½•**
```bash
WORKSPACE_PATH=/path/to/readonly/knowledge-base
```

**æ–¹å¼ 3ï¼šå®¹å™¨ / è™šæ‹Ÿæœºéš”ç¦»**  
åœ¨ Docker å®¹å™¨æˆ–è™šæ‹Ÿæœºä¸­è¿è¡Œï¼ŒæŒ‚è½½åªè¯»çŸ¥è¯†åº“ç›®å½•ï¼Œä¸ä¸»æœºæ–‡ä»¶ç³»ç»Ÿéš”ç¦»ã€‚

---

## å¿«é€Ÿå¼€å§‹

### ä¾èµ–

- [Node.js](https://nodejs.org/) >= 18
- [AgentAPI](https://github.com/coder/agentapi)ï¼ˆGo ç¼–è¯‘ï¼‰
- [Claude CLI](https://github.com/anthropics/claude-code) æˆ– [Gemini CLI](https://github.com/google-gemini/gemini-cli)

### éƒ¨ç½²æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/JiangJingC/MiniRAG-Local.git
cd MiniRAG-Local

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥è·¯å¾„å’Œå¯†é’¥

# 3. å¯åŠ¨
chmod +x scripts/start_ai.sh scripts/stop_ai.sh
./scripts/start_ai.sh          # é»˜è®¤ claude æ¨¡å¼
./scripts/start_ai.sh gemini   # ä½¿ç”¨ gemini
```

å¯åŠ¨åæœåŠ¡åœ°å€ï¼š`http://localhost:62000/v1/chat/completions`ï¼ˆOpenAI å…¼å®¹ï¼‰

### é’‰é’‰ç¾¤æœºå™¨äºº

1. åœ¨[é’‰é’‰å¼€å‘è€…åå°](https://open.dingtalk.com)åˆ›å»ºä¼ä¸šå†…éƒ¨åº”ç”¨ï¼Œå¼€å¯ã€Œæœºå™¨äººã€èƒ½åŠ›ï¼Œè¿æ¥æ–¹å¼é€‰ **Stream æ¨¡å¼**ï¼ˆæ— éœ€å…¬ç½‘ IPï¼‰
2. åœ¨ `.env` ä¸­å¡«å…¥ï¼š

```env
DINGTALK_APP_KEY=ä½ çš„AppKey
DINGTALK_APP_SECRET=ä½ çš„AppSecret
DINGTALK_RAG_GROUPS={"ç¾¤conversationId": {"endpoint": "http://localhost:62000/v1/chat/completions", "model": "rag", "timeoutMs": 30000}}
```

3. é‡å¯æœåŠ¡ï¼Œåœ¨é’‰é’‰ç¾¤ @ æœºå™¨äººå³å¯

**è·å– conversationId**ï¼šç¾¤é‡Œ @ æœºå™¨äººå‘ä»»æ„æ¶ˆæ¯ï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š
```bash
tail -f /tmp/dingtalk_bot.log
```

### æ²¹çŒ´æ’ä»¶

å°† `examples/agent_api_user_script.js` å¯¼å…¥ Tampermonkeyï¼Œå¯åœ¨ä»»æ„ç½‘é¡µå³ä¸‹è§’å‘¼å‡ºçŸ¥è¯†åº“å¯¹è¯æ¡†ã€‚

---

## é¡¹ç›®ç»“æ„

```
MiniRAG-Local/
â”œâ”€â”€ proxy/
â”‚   â”œâ”€â”€ openai_proxy.js      # OpenAI å…¼å®¹æ¥å£å±‚
â”‚   â”œâ”€â”€ text-utils.js        # TUI è¾“å‡ºæ¸…æ´—
â”‚   â””â”€â”€ env-utils.js         # .env è§£æ
â”œâ”€â”€ dingtalk/
â”‚   â””â”€â”€ bot.js               # é’‰é’‰ Stream æœºå™¨äºº
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start_ai.sh          # ä¸€é”®å¯åŠ¨
â”‚   â””â”€â”€ stop_ai.sh           # åœæ­¢æœåŠ¡
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ agent_api_user_script.js  # æ²¹çŒ´æ’ä»¶
â”œâ”€â”€ docs/                    # æŠ€æœ¯æ–‡æ¡£
â””â”€â”€ .env.example             # é…ç½®æ¨¡æ¿
```

---

## è®¸å¯è¯

[MIT License](LICENSE)

---

*MiniRAG-Local â€” è®© AI Agent ç›´æ¥æˆä¸ºä½ çš„çŸ¥è¯†åº“å¼•æ“ã€‚*
